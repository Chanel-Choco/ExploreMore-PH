<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Debug</title>
  </head>
  <body>
    <h1>Dashboard Debug Page</h1>

    <div id="debugInfo"></div>

    <script>
      function addDebugInfo(message) {
        const div = document.getElementById("debugInfo");
        div.innerHTML +=
          "<p>" + new Date().toLocaleTimeString() + ": " + message + "</p>";
        console.log(message);
      }

      // Check if user is in sessionStorage
      addDebugInfo("Checking sessionStorage...");
      const user = JSON.parse(sessionStorage.getItem("user") || "null");
      addDebugInfo("User in sessionStorage: " + JSON.stringify(user));

      if (!user) {
        addDebugInfo("❌ No user found in sessionStorage");
      } else if (user.role !== "admin") {
        addDebugInfo("❌ User is not admin: " + user.role);
      } else {
        addDebugInfo("✅ User is admin: " + user.username);
      }

      // Check if config is loaded
      addDebugInfo("Checking global config...");
      if (window.ExploreMoreConfig) {
        addDebugInfo(
          "✅ Config loaded: " + window.ExploreMoreConfig.API_BASE_URL
        );
      } else {
        addDebugInfo("❌ Config not loaded");
      }

      // Test API call
      addDebugInfo("Testing API call...");
      const API_BASE_URL =
        window.ExploreMoreConfig?.API_BASE_URL ||
        "https://exploremore-production-c375.up.railway.app";

      fetch(`${API_BASE_URL}/api/users-with-feedback`, {
        credentials: "include",
      })
        .then((response) => {
          addDebugInfo("API Response status: " + response.status);
          return response.json();
        })
        .then((data) => {
          addDebugInfo("API Response data: " + JSON.stringify(data));
          if (data.success && data.users) {
            addDebugInfo(
              "✅ API call successful, got " + data.users.length + " users"
            );
          } else {
            addDebugInfo(
              "❌ API call failed: " + (data.message || "Unknown error")
            );
          }
        })
        .catch((error) => {
          addDebugInfo("❌ API call error: " + error.message);
        });
    </script>

    <!-- Load config first -->
    <script src="config.js"></script>

    <!-- Then test again after config loads -->
    <script>
      setTimeout(() => {
        addDebugInfo("Rechecking after config load...");
        if (window.ExploreMoreConfig) {
          addDebugInfo(
            "✅ Config now loaded: " + window.ExploreMoreConfig.API_BASE_URL
          );
        } else {
          addDebugInfo("❌ Config still not loaded");
        }
      }, 100);
    </script>
  </body>
</html>
